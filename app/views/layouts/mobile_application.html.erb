<!DOCTYPE html>
<html lang='en'>
    <head>
        <meta charset="utf-8">
        <%= csrf_meta_tags %>
        <title><%= full_title(yield(:title)) %></title>
        <%= stylesheet_link_tag "mobile", media: "all",
                                               "data-turbolinks-track" => true %>
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
        <link href='http://fonts.googleapis.com/css?family=Capriola' rel='stylesheet' type='text/css'>
        <!-- touchSwipe library -->


        <%= javascript_include_tag "application", "data-turbolinks-track" => true %>
        <script src="http://labs.rampinteractive.co.uk/touchSwipe/jquery.touchSwipe.min.js"></script>

        <meta name="description" content="">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0" />

        <meta http-equiv="cleartype" content="on">

        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="mobile-web-app-capable" content="yes">


        <!-- Tile icon for Win8 (144x144 + tile color) -->
        <meta name="msapplication-TileImage" content="img/touch/apple-touch-icon-144x144-precomposed.png">
        <meta name="msapplication-TileColor" content="#222222">

        <!-- Add to homescreen for Chrome on Android -->
        <meta name="mobile-web-app-capable" content="yes">

        <!-- For iOS web apps. Delete if not needed. https://github.com/h5bp/mobile-boilerplate/issues/94 -->
        <!--
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <meta name="apple-mobile-web-app-title" content="">
        -->

        <!-- This script prevents links from opening in Mobile Safari. https://gist.github.com/1042026 -->
        <!--
        <script>(function(a,b,c){if(c in b&&b[c]){var d,e=a.location,f=/^(a|html)$/i;a.addEventListener("click",function(a){d=a.target;while(!f.test(d.nodeName))d=d.parentNode;"href"in d&&(d.href.indexOf("http")||~d.href.indexOf(e.host))&&(a.preventDefault(),e.href=d.href)},!1)}})(document,window.navigator,"standalone")</script>
        -->
    </head>
    <body ondragstart="return false;" ondrop="return false;" <%= "class=#{@body_class}" if @body_class %>>
        <% if signed_in? %>
        <nav class="nav ssm-nav-visible">
            <div class='side-nav-top'>
                <% if signed_in? %>
                    <div class="side-nav__user-info">
                        <h2 class="side-nav__close">Swipe to close</h2>
                        <% if !current_user.oath_image.blank? %>
                            <div style='text-align:center;'><%= image_tag(current_user.oath_image) %></div>
                        <% end %>
                        <h2 class="side-nav__username"><%= current_user.name %></h2>
                        <h2 class='lifetime-credits'> <span class='credits'><%= pluralize(current_user.lifetime_credits, 'liftime earning')%></span></h2>
                    </div>
                    <ul class="side-nav_links">
                            <li>
                                <%= embedded_svg('svgs/icons/redeem.svg', :class => 'settings-icon') %>
                                <%= link_to redeem_path do %>
                                    Redeem Credits
                                <% end %>
                                <span class='redeem'><%= current_user.credits ||= 0%> </span>
                            </li>
                        <li>
                            <%= embedded_svg('svgs/icons/gear42.svg', :class => 'settings-icon') %>
                            <%= link_to edit_user_path(current_user) do %>
                                Settings
                            <% end %>
                        </li>

                        <li>
                            <%= embedded_svg('svgs/icons/homework.svg', :class => 'survey-icon') %>
                            <%= link_to "Survey", surveys_path %>
                            <span class='survey-credits'>+100</span>
                        </li>

                        <li>
                            <i class="fa fa-user-plus survey-icon"></i>
                            <%= link_to refer_path do %> Invite Friends <% end %>
                            <span class='survey-credits'>+50</span>
                        </li>
                    </ul>
                    <div class="side-nav__signout">
                        <i class="fa fa-sign-out"></i>
                        <%= link_to "Sign out", signout_path, method: "delete", class: 'side-nav__signout-link'%>
                    </div>
                <% end %>
            </div><!--/.side-nav-top -->
        </nav>

        <div class="ssm-overlay"></div>

        <% end %>

        <div class='mobile-container <% if !signed_in? %>with-money<% end %>' style="width:100%;">
            <div class="mobile--overlay">
                <a href="/" class="overlay__opt-out">Preview in Browser</a>
                <div class="overlay__content">
                    <img class="overlay__logo" src="/assets/logo-144.png">
                    <h1 class="overlay__title">Luckee</h1>
                    <p>To install, tap <img class="overlay__bookmark" src="/assets/bookmark.png"> and choose</p>
                    <p>"Add to Home Screen"</p>
                    <i class="overlay__down-arrow ios fa fa-long-arrow-down"></i>
                </div>
            </div>
            <% if signed_in? %>
                <div class='mobile-header'>
                    <% if @game %>
                    <%= link_to games_path do %>
                    <i class="fa fa-chevron-left back-button"></i>
                    <% end %>
                    <% else %>
                         <div class="ssm-open-nav" title="open nav" >
                            <i class="fa fa-bars mobile-menu"></i>
                        </div>
                    <% end %>
                    <% if @game %>
                        <h2><%= @game.name %><br /><span class='credits' <% if @game.name == 'Sorcerer Game' %>style='top:0px'<% end %>><%= current_user.credits ||= 0 %> credits</span></h2>
                    <% else %>
                        <h2><%= link_to games_path do %>Luckee<% end %><br /><span class='credits'><%= current_user.credits ||= 0 %> credits</span></h2>
                    <% end %>
                    <div class='referral-link'>

                        <div class="share-dialog js-share-dialog">
                            <div class="arrow-up"></div>
                            <p>When you invite a friend and they sign up through your personalized link, you earn <span>25 credits</span></p>
                            <p>Copy &amp; share:</p>
                            <p class="share-dialog__link"><%= request.host_with_port %>/invite/<%=@referal_code %></p>
                            <div class="share-dialog__close-container">
                                <p class="share-dialog__close js-share-dialog__close">Got it</p>
                            </div>
                        </div> <!--/.share-dialog -->

                        <%= link_to refer_path do %>
                            <i class="fa fa-user-plus">
                                <span class="earn">+50</span>
                            </i>
                        <% end %>
                    </div>
                </div>
            <% else %>
                <img src="/assets/homescreen-logo.png" class="top-title">
            <% end %>
          <% flash.each do |key, value| %>
            <div class="alert alert-<%= key %>"><%= value %></div>
          <% end %>
          <%= yield %>
        </div>
        <% if signed_in? %>
            <script>
                 $('.nav').slideAndSwipe();
                 $(document).ready(function(){
                    if(/iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream){
                      document.querySelector('meta[name=viewport]')
                        .setAttribute(
                          'content',
                          'initial-scale=1.0001, minimum-scale=1.0001, maximum-scale=1.0001, user-scalable=no'
                        );
                    }
                     //$('.ssm-open-nav').trigger('click');
                 });
            </script>

        <% end %>

         <% if Rails.env.production? %>
            <!-- google analytics -->
            <script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-58032053-2', 'auto');
              ga('send', 'pageview');


            </script>
        <% end %>
        <%= yield(:game_javascript) %>


    </body>
</html>
