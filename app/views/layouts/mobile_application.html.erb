<!DOCTYPE html>
<html lang='en'>
    <head>
        <meta charset="utf-8">
        <%= csrf_meta_tags %>
        <title><%= full_title(yield(:title)) %></title>

        <script>
        (function(a,b,c){if(c in b&&b[c]){var d,e=a.location,f=/^(a|html)$/i;a.addEventListener("click",function(a){d=a.target;while(!f.test(d.nodeName))d=d.parentNode;"href"in d&&(chref=d.href).replace(e.href,"").indexOf("#")&&(!/^[a-z\+\.\-]+:/i.test(chref)||chref.indexOf(e.protocol+"//"+e.host)===0)&&(a.preventDefault(),e.href=d.href)},!1)}})(document,window.navigator,"standalone");
        </script>

        <%= stylesheet_link_tag "mobile", media: "all",
                                               "data-turbolinks-track" => true %>
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
        <link href='http://fonts.googleapis.com/css?family=Capriola' rel='stylesheet' type='text/css'>
        <!-- touchSwipe library -->

        <!-- iOS Load Screen -->

        <!-- iPhone SPLASHSCREEN-->
        <link href="/assets/apple-touch-startup-image-320x460.png" media="(device-width: 320px)" rel="apple-touch-startup-image">
        <!-- iPhone (Retina) SPLASHSCREEN-->
        <link href="/assets/apple-touch-startup-image-640x920.png" media="(device-width: 320px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image">
        <!-- iPhone 5 (Retina) SPLASHSCREEN-->
        <link href="/assets/apple-touch-startup-image-640x1136.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image">
        <!-- iPad (portrait) SPLASHSCREEN-->
        <link href="/assets/apple-touch-startup-image-768x1004.png" media="(device-width: 768px) and (orientation: portrait)" rel="apple-touch-startup-image">
        <!-- iPad (landscape) SPLASHSCREEN-->
        <link href="/assets/apple-touch-startup-image-748x1024.png" media="(device-width: 768px) and (orientation: landscape)" rel="apple-touch-startup-image">
        <!-- iPad (Retina, portrait) SPLASHSCREEN-->
        <link href="/assets/apple-touch-startup-image-1536x2008.png" media="(device-width: 1536px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image">
        <!-- iPad (Retina, landscape) SPLASHSCREEN-->
        <link href="/assets/apple-touch-startup-image-2048x1496.png" media="(device-width: 1536px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image">
        <!-- iPhone 6 Plus portrait startup image -->
        <link href="/assets/1242x2148.png" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" rel="apple-touch-startup-image">
        <!-- iPhone 6 Plus landscape startup image -->
        <link href="/assets/1182x2208.png" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" rel="apple-touch-startup-image">
        <!-- iPhone 6 startup image -->
        <link href="/assets/750x1294.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image">
        <!-- iPhone 5 startup image -->
        <link href="/assets/640x1096.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image">
        <!-- iPhone < 5 retina startup image -->
        <link href="/assets/640x920.png" media="(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image">

        <!-- Favicon -->
        <link rel="shortcut icon" href="/assets/favicon-16x16.png">

        <!-- iOS Icon Images -->
        <link rel="apple-touch-icon" href="/assets/apple-touch-icon-60x60.png">
        <link rel="apple-touch-icon" sizes="76x76" href="/assets/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="120x120" href="/assets/apple-touch-icon-120x120.png">
        <link rel="apple-touch-icon" sizes="152x152" href="/assets/apple-touch-icon-152x152.png">

        <!-- Android Icon Image -->
        <link rel="icon" sizes="192x192" href="/assets/android-chrome-192x192.png">
        <link rel="icon" sizes="144x144" href="/assets/android-chrome-144x144.png">
        <link rel="icon" sizes="96x96" href="/assets/android-chrome-96x96.png">
        <link rel="icon" sizes="72x72" href="/assets/android-chrome-72x72.png">
        <link rel="icon" sizes="48x48" href="/assets/android-chrome-48x48.png">
        <link rel="icon" sizes="36x36" href="/assets/android-chrome-36x36.png">

        <%= javascript_include_tag "application", "data-turbolinks-track" => true %>
        <script src="http://labs.rampinteractive.co.uk/touchSwipe/jquery.touchSwipe.min.js"></script>

        <meta name="description" content="">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0" />

        <meta http-equiv="cleartype" content="on">

        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="mobile-web-app-capable" content="yes">


        <!-- Tile icon for Win8 (144x144 + tile color) -->
        <meta name="msapplication-TileImage" content="img/touch/apple-touch-icon-144x144-precomposed.png">
        <meta name="msapplication-TileColor" content="#222222">

        <!-- Add to homescreen for Chrome on Android -->
        <meta name="mobile-web-app-capable" content="yes">

        <!-- For iOS web apps. Delete if not needed. https://github.com/h5bp/mobile-boilerplate/issues/94 -->
        <!--
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <meta name="apple-mobile-web-app-title" content="">
        -->

        <!-- This script prevents links from opening in Mobile Safari. https://gist.github.com/1042026 -->
        <!--
        <script>(function(a,b,c){if(c in b&&b[c]){var d,e=a.location,f=/^(a|html)$/i;a.addEventListener("click",function(a){d=a.target;while(!f.test(d.nodeName))d=d.parentNode;"href"in d&&(d.href.indexOf("http")||~d.href.indexOf(e.host))&&(a.preventDefault(),e.href=d.href)},!1)}})(document,window.navigator,"standalone")</script>
        -->

         <% if Rails.env.production? %>
            <!-- Pulse -->
            <script type="text/javascript">
              !function(a,b,c,d,e,f,g,h){a.RaygunObject=e,a[e]=a[e]||function(){
              (a[e].o=a[e].o||[]).push(arguments)},f=b.createElement(c),g=b.getElementsByTagName(c)[0],
              f.async=1,f.src=d,g.parentNode.insertBefore(f,g),h=a.onerror,a.onerror=function(b,c,d,f,g){
              h&&h(b,c,d,f,g),g||(g=new Error(b)),a[e].q=a[e].q||[],a[e].q.push({
              e:g})}}(window,document,"script","//cdn.raygun.io/raygun4js/raygun.min.js","rg4js");
            </script>

            <!-- start google analytics -->
            <script>
                var strUserId = null;

                <% if current_user %>
                    strUserId = "<%= current_user.id %>";
                <% end %>

                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-58032053-2', {'userId': strUserId}); //reset third argument to 'auto'
                ga('set', 'dimension1', strUserId);
                // if (strUserId) { ga('set', 'userId', strUserId); };
                ga('send', 'pageview');

            </script>
            <!-- end google analytics -->
        <% end %>
        <%= yield(:game_javascript) %>
    </head>
    <body ondragstart="return false;" ondrop="return false;" class="<%= yield (:body_class) %>">
        <% if signed_in? %>
        <nav class="nav ssm-nav-visible">
            <div class='side-nav-top'>
                <% if signed_in? %>
                    <div class="side-nav__user-info">
                        <h2 class="side-nav__close">Swipe to close</h2>
                            <div class="side-nav__avatar" style="<% if current_user.oath_image %>background-image: url(<%= current_user.oath_image %>); <% else %> background-image: url(/assets/avatar-icon.png); <% end %>"></div>
                        <h2 class="side-nav__username"><%= current_user.name %></h2>
                        <h2 class='lifetime-credits'> <span class='credits'><%= pluralize(current_user.credits, 'credit')%></span></h2>
                    </div>
                    <ul class="side-nav_links">
                        <%= link_to redeem_path do %>
                        <li>
                            <%= embedded_svg('svgs/icons/redeem.svg', :class => 'settings-icon') %>

                                Redeem Credits

                            <span class='survey-credits'><%= current_user.credits ||= 0%> </span>
                        </li>
                        <% end %>

                        <%= link_to refer_path do %>
                        <li>
                            <i class="fa fa-user-plus survey-icon"></i>
                            Invite Friends
                            <span class='survey-credits'>+25</span>
                        </li>
                        <% end %>

                        <%= link_to surveys_path do %>
                        <li>
                            <%= embedded_svg('svgs/icons/homework.svg', :class => 'survey-icon') %>
                            Take Survey
                            <span class='survey-credits'>+100</span>
                        </li>
                        <% end %>
                        <a href="mailto:support@getluckee.com" target="_top">
                            <li>
                                <i class="fa fa-envelope-o"></i>
                                Contact Us
                            </li>
                        </a>
                        <%= link_to edit_user_path(current_user) do %>
                        <li class="side-nav__settings">
                            <%= embedded_svg('svgs/icons/gear42.svg', :class => 'settings-icon') %>

                                Settings

                        </li>
                        <% end %>
                    </ul>
                    <div class="side-nav__signout">
                        <i class="fa fa-sign-out"></i>
                        <%= link_to "Sign out", signout_path, method: "delete", class: 'side-nav__signout-link'%>
                    </div>
                <% end %>
            </div><!--/.side-nav-top -->
        </nav>

        <div class="ssm-overlay"></div>

        <% end %>

        <div <%= "id=#{@mobile_container_id}" if @mobile_container_id %> class='mobile-container <% if !signed_in? %>with-money<% end %>' style="width:100%;">
            <div class="desktop--modal">
                <h1 class="modal__title">Welcome to Luckee</h1>
                <p class="modal__copy">Our desktop site is currently under construction. We have enabled our mobile site on desktop, so you can proceed, but it may look a little goofy for now. Please visit the site on mobile for the best experience, or continue to the temporary desktop site and we will have our new desktop site up for your ASAP.</p>
                <span class="modal__link js-modal__link">Proceed to Temporary Site</span>
            </div>
            <div class="mobile--overlay">
                <a href="/" class="js-overlay__opt-out overlay__opt-out ga-preview-event">Preview in Browser</a>
                <a href="/" class="overlay__back-to-dash"><img class="home-icon--small" src="/assets/home_icon.png"></a>
                <div class="overlay__content">
                    <img class="overlay__logo" src="/assets/logo-144.png">
                    <h1 class="overlay__title">Luckee</h1>
                    <p>To install, tap <img class="overlay__bookmark" src="/assets/bookmark.png"> and choose</p>
                    <p>"Add to Home Screen"</p>
                    <i class="overlay__down-arrow ios fa fa-long-arrow-down"></i>
                </div>
                <div class="rotate-dialogue">
                            <i class="fa fa-repeat rotate__icon"></i>
                            <h1 class="rotate__title">Please rotate your screen to play!</h1>
                </div>
            </div>
            <% if signed_in? %>
                <div class='mobile-header' <% if @game && Game.where(slug:['traffic','flappy-pilot','fall-down']).pluck(:id).include?(@game.id) %> style='display:none;'<% end %>>
                    <% if @show_back_button %>
                        <% if @back_button_action %>
                            <span class='<%= @back_button_action %>'style='display:none'><i class="fa fa-chevron-left back-button"></i></span>
                                <%= link_to games_path, :class=>'back-link' do %>
                                 <i class="fa fa-chevron-left back-button"></i>
                                <% end %>
                        <% else @show_back_button %>
                            <%= link_to games_path do %>
                             <i class="fa fa-chevron-left back-button"></i>
                            <% end %>
                        <% end %>
                    <% else %>
                         <div class="ssm-open-nav" title="open nav" >
                            <i class="fa fa-bars mobile-menu"></i>
                        </div>
                    <% end %>
                    <% if @game %>
                        <h2 style='font-size:27px;'><%= @game.name %><br /><span class='credits' <% if @game.name == 'Sorcerer Game' %>style='top:0px'<% end %>><%= current_user.credits ||= 0 %> credits</span></h2>
                    <% else %>
                        <h2><%= link_to games_path do %><img src="/assets/luckee-font.png" class="mobile-header__logo"><% end %><br /><span class='credits mobile-header__credits'><%= current_user.credits ||= 0 %> credits</span></h2>
                    <% end %>
                    <div class='referral-link'>

                        <div class="share-dialog js-share-dialog">
                            <div class="arrow-up"></div>
                            <p>When you invite a friend and they sign up through your personalized link, you earn <span>25 credits</span></p>
                            <p>Copy &amp; share:</p>
                            <p class="share-dialog__link"><%= request.host_with_port %>/invite/<%=@referal_code %></p>
                            <div class="share-dialog__close-container">
                                <p class="share-dialog__close js-share-dialog__close">Got it</p>
                            </div>
                        </div> <!--/.share-dialog -->

                        <%= link_to refer_path do %>
                            <i class="fa fa-user-plus"></i>
                            <span class="earn">+25</span>
                        <% end %>
                    </div>
                </div>
            <% else %>
                <img src="/assets/homescreen-logo.png" class="top-title">
            <% end %>
          <% flash.each do |key, value| %>
            <div class="alert alert-<%= key %>"><%= value %></div>
          <% end %>
          <%= yield %>
        </div>
        <% if signed_in? %>
            <script>
                 $('.nav').slideAndSwipe();
                 $(document).ready(function(){
                    if(/iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream){
                      document.querySelector('meta[name=viewport]')
                        .setAttribute(
                          'content',
                          'initial-scale=1.0001, minimum-scale=1.0001, maximum-scale=1.0001, user-scalable=no'
                        );
                    }
                     //$('.ssm-open-nav').trigger('click');
                 });
            </script>

        <% end %>

         <% if Rails.env.production? %>
            <!-- GA Tracking Events -->
            <%# render 'layouts/tracking_events' %>

            <script type="text/javascript">
              rg4js('apiKey', 'K9ewfiwAigDX1AXxc+lC0Q==');
              rg4js('attach', true);
              rg4js('enablePulse', true);
            </script>
        <% end %>


    </body>
</html>
